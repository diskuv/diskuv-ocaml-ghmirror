## 1.0.2 (@@YYYYMMDD@@)

Quick Links:
|             |                                                                                                                         |
| ----------- | ----------------------------------------------------------------------------------------------------------------------- |
| Installer   | https://github.com/diskuv/dkml-installer-ocaml/releases/download/v1.0.2/setup-diskuv-ocaml-windows_x86_64-1.0.2.exe     |
| Uninstaller | https://github.com/diskuv/dkml-installer-ocaml/releases/download/v1.0.2/uninstall-diskuv-ocaml-windows_x86_64-1.0.2.exe |

**Upgrading?**
* Uninstall the old version first! On Windows you can go to the
  "Add or remove programs" utility in your Control Panel and remove
  the "Diskuv OCaml" program. You can also use the standalone uninstaller
  that will automatically remove any old versions.

New features:
* Add odoc 2.1.0 to PATH, to align with the [OCaml Platform](https://ocaml.org/docs/platform).
* Relocatable native binaries are installed rather than compiled into place.
  Installations should be quicker, which is a pre-requisite for `winget install`
  on Windows.

Breaking changes:
* Cross-compiling on macOS with dkml-base-compiler now requires you to be explicit
  which CPU architecture you are targeting. Before using `dune -x darwin_arm64`
  would always cross-compile both Intel and Silicon. Now Silicon developers
  need to use `dune -x darwin_x86_64` and Intel developers need to use
  `dune -x darwin_arm64`. The change was necessary to not rely on the presence
  of optional Rosetta2 translation. *Since this cross-compiling feature is little used, it does not warrant a breaking version bump*.

Bug fixes:
* The Visual Studio installer now always downloads the latest Build Tools installer,
  which avoids TLS configuration problems with older (unpatched) Windows 10 and 11 machines.
* The dune.exe shim uses a cache containing the expensive-to-compute MSVC environment settings. A race condition populating the cache has been fixed.
* Repetitive opam repository updates, as source of slowness, were eliminated
  during installation.

Component changes:
* opam.exe is compiled directly from the opam master branch; no patches! There is
  still a shim but that shim just sets up environment variables and delegates
  to the authoritative (unpatched) opam.

Reproducibility features:
* Packages promoted to central Opam repository:
  * dkml-runtime-common
  * dkml-runtime-distribution
  * dkml-component-opam
* Introduce simple spec for which package+versions are installed and/or compiled
  as part of the DKML distribution (in dkml-runtime-distribution). Eventually it
  will become authoritative.
* Introduce dkml-component-desktop which does CI for changes to that spec (aka.
  testing new package versions for Windows using MSVC), and builds all relocatable
  binaries like dune and ocp-indent used in the Windows installer. It is not
  yet in the central Opam repository.

Usability tweaks:
* When building DKML packages like dkml-base-compiler, limit dump of Opam
  logs used for troubleshooting to 4 hours

Internal changes:
* with-dkml.exe is now configured as a opam wrapper relative to the
  installation directory ($DiskuvOCamlHome) rather than the tools opam switch.
  That change decouples your new switches (aka. opam dkml init) from another
  opam switch.
